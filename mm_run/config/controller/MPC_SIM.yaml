# MPC Controller configuration for simulation
# Extends MPC.yaml with simulation-specific settings

include:
  - package: "mm_run"
    path: "config/controller/MPC.yaml"

controller:
  # Simulation-specific overrides
  ctrl_rate: 20  # Higher rate for simulation (20 Hz vs 10 Hz for real robot)

  # Disable collision avoidance for simpler simulation
  self_collision_avoidance_enabled: False
  sdf_collision_avoidance_enabled: False
  static_obstacles_collision_avoidance_enabled: False

  # Simplified collision constraint type (scalar instead of per-type dict)
  collision_constraint_type: "SignedDistanceConstraint"

  # Enable soft constraints for SDF and static obstacles in simulation
  collision_constraints_softened:
    sdf: True
    static_obstacles: True

  # Smaller safety margin for SDF in simulation
  collision_safety_margin:
    sdf: 0.15

  # Simplified CBF gamma (scalar instead of per-type dict)
  collision_cbf_gamma: 0.9

  # Cost params using unified names (BasePose, BaseVel, EEPose, EEVel)
  cost_params:
    # End-effector pose (SE3: x, y, z, roll, pitch, yaw)
    EEPose:
      Qk: [10.0, 10.0, 10.0, 10.0, 10.0, 10.0]  # Position weights, orientation weights
      P: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0]

    # Base pose (SE2: x, y, yaw)
    BasePose:
      Qk: [10.0, 10.0, 10.0]  # [x, y, yaw]
      P: [1.0, 1.0, 1.0]

    # End-effector velocity (6D: 3D linear + 3D angular)
    EEVel:
      Qk: [5.0, 5.0, 5.0, 10.0, 10.0, 10.0]  # [vx, vy, vz, wx, wy, wz]
      P: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0]

    # Base velocity (3D: vx, vy, vyaw)
    BaseVel:
      Qk: [5.0, 5.0, 5.0]  # [vx, vy, vyaw]
      P: [1.0, 1.0, 1.0]

    # Control effort
    Effort:
      Qqa: 0.0
      Qqb: 0.0
      Qva: 0.01
      Qvb: 0.01
      Qua: 0.005
      Qub: 0.005
      Qdua: 0.0
      Qdub: 0.1

    # Slack variables
    slack:
      z: 100  # Higher slack penalty for simulation

  # ACADOS solver options for simulation
  acados:
    ocp_solver_options:
      nlp_solver_type: "SQP"  # Use SQP instead of SQP_RTI for simulation
      nlp_solver_tol_stat: 1.0e-04  # Tighter tolerance
    slack_enabled:
      u: True  # Enable slack for control inputs in simulation
      h_e: False  # Disable slack for terminal constraints
